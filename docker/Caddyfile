{
    # Admin API on port 2019 (internal to Docker network only, not host-exposed)
    admin :2019

    # Use Caddy's internal CA for all auto-provisioned certificates.
    # When the gateway provisioner adds routes for instance subdomains via the
    # Admin API, Caddy discovers the new hostname in the route's host matcher
    # and automatically provisions an internal TLS cert for it.
    local_certs
}

# Hub domain only â€” serves the gateway API and hub SPA.
# Instance routes are added dynamically via the Caddy Admin API by the gateway
# provisioner after each instance container is started.
{$HUB_DOMAIN:localhost} {
    reverse_proxy gateway:80

    log {
        output stdout
        format console
    }
}

mail.{$HUB_DOMAIN:localhost} {
    tls internal
    reverse_proxy mailpit:8025
}
